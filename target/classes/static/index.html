<button id="pay-button">Pay Now</button>
<script src="https://checkout.razorpay.com/v1/checkout.js"></script>

<script>
document.getElementById('pay-button').onclick = function () {
    // Step 1: Create Razorpay Order in backend
    fetch('http://localhost:8989/aimdev/api/auth/createPayment?amount=100&currency=INR&orderId=1', {
        method: 'POST'
    })
    .then(response => response.json())
    .then(order => {
        // Step 2: Open Razorpay Checkout
        const options = {
            key: "rzp_live_vegmIuWT1fULsb", // Replace with your API key
            amount: order.amount,
            currency: order.currency,
            name: "Your Company",
            description: "Test Transaction",
            order_id: order.razorpayOrderId, // should match backend response
            handler: function (response) {
                console.log("Payment handler response:", response);

                // Step 3: Wait for webhook to update status, then fetch from backend
                setTimeout(() => {
                    fetch(`http://localhost:8989/aimdev/api/auth/getPaymentStatus?razorpayOrderId=${order.razorpayOrderId}`)
                        .then(res => res.json())
                        .then(data => {
                            alert("Payment Status: " + data.paymentStatus);
                        })
                        .catch(err => console.error("Error fetching payment status", err));
                }, 2000); // wait 2 sec to allow webhook to process
            },
            theme: {
                color: "#3399cc"
            }
        };
        const rzp = new Razorpay(options);
        rzp.open();
    })
    .catch(err => console.error("Error creating Razorpay order", err));
};
</script>
